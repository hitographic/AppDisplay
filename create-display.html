<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#e31e24">
    <title>Create Display - MDS Track</title>
    <link rel="icon" type="image/png" href="assets/Favicon MDS.png">
    <link rel="apple-touch-icon" href="assets/App MDS.png">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .info-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            color: #333;
        }
        .info-badge i {
            color: #e31e24;
        }
        .info-badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .btn-edit-info {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-edit-info:hover {
            background: #e67e22;
        }
        .edit-form-container {
            display: none;
            background: #fff3cd;
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
        }
        .edit-form-container.show {
            display: block;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <img src="assets/Navigation MDS.png" alt="MDS" class="nav-logo">
        </div>
        <div class="nav-user">
            <span id="userName">User</span>
            <button class="btn-logout" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Kembali
            </button>
        </div>
    </nav>
    <main style="max-width: 900px; margin: 0 auto; padding: 30px;">
        <div class="page-header">
            <h1><i class="fas fa-camera"></i> Create Display</h1>
            <p id="pageSubtitle">Buat data display baru dengan memilih foto dari master data</p>
        </div>

        <!-- Info badges from popup (read-only display) -->
        <div id="infoBadgesSection" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <div class="info-badges-container" id="infoBadges">
                <!-- Will be populated by JS -->
            </div>
            <button class="btn-edit-info" onclick="toggleEditForm()">
                <i class="fas fa-edit"></i> Edit Info
            </button>
            
            <!-- Hidden edit form -->
            <div class="edit-form-container" id="editFormContainer">
                <h3 style="margin: 0 0 15px 0; font-size: 1rem;"><i class="fas fa-edit"></i> Edit Informasi Display</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px;">Flavor</label>
                        <input type="text" id="flavor" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px;">Nomor Material</label>
                        <input type="text" id="nomorMaterial" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px;">Negara</label>
                        <input type="text" id="negara" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px;">Distributor</label>
                        <input type="text" id="distributor" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 13px;">Tanggal</label>
                        <input type="date" id="tanggal" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                    </div>
                </div>
                <button onclick="saveEditInfo()" style="margin-top: 15px; background: #27ae60; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">
                    <i class="fas fa-check"></i> Simpan Perubahan
                </button>
            </div>
        </div>

        <div id="googleDriveAlert" class="google-drive-alert" style="display: none;">
            <div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="alert-content">
                <h3>Google Drive: Tidak Terkoneksi</h3>
                <p>Hubungkan ke Google Drive untuk memilih foto master data.</p>
            </div>
            <button class="btn-connect-drive" onclick="connectGoogleDrive()">
                <i class="fas fa-plug"></i> Hubungkan
            </button>
        </div>
        <div id="googleDriveConnected" class="google-drive-connected" style="display: none;">
            <div class="alert-icon"><i class="fas fa-check-circle"></i></div>
            <div class="alert-content">
                <h3>Google Drive: Terkoneksi</h3>
                <p>Siap membuat display baru.</p>
            </div>
        </div>

        <div style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="margin: 0 0 20px 0; font-size: 1.1rem;"><i class="fas fa-images"></i> Pilih Foto dari Master Data</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-pepper-hot"></i> Bumbu</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="bumbu" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="bumbuDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-oil-can"></i> M. Bumbu</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="mBumbu" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="mBumbuDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-barcode"></i> SI</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="si" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="siDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-box"></i> Karton Depan</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="kartonDepan" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="kartonDepanDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-box-open"></i> Karton Belakang</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="kartonBelakang" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="kartonBelakangDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-tag"></i> Etiket</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="etiket" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="etiketDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-cubes"></i> Etiket Banded</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="etiketBanded" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="etiketBandedDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;"><i class="fas fa-tape"></i> Plakban</label>
                    <div class="autocomplete-wrapper">
                        <input type="text" id="plakban" placeholder="Ketik nama file..." autocomplete="off" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <div id="plakbanDropdown" class="autocomplete-dropdown hidden"></div>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px; flex-wrap: wrap;">
                <button onclick="saveTemporary()" style="background: #f39c12; color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-save"></i> Simpan Sementara
                </button>
                <button id="btnPreview" onclick="showPreview()" style="display: none; background: #3498db; color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button id="btnSaveAll" onclick="saveAll()" style="display: none; background: #27ae60; color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer;">
                    <i class="fas fa-check-circle"></i> Simpan Semua
                </button>
            </div>
        </div>
    </main>
    <div id="previewModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px;">
        <div style="background: white; border-radius: 12px; width: 100%; max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div style="padding: 20px; border-bottom: 1px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin: 0;"><i class="fas fa-images"></i> Preview Foto Display</h3>
                <button onclick="closePreview()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div style="padding: 25px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>Flavor:</strong> <span id="previewFlavor">-</span></div>
                        <div><strong>Nomor Material:</strong> <span id="previewNomorMaterial">-</span></div>
                        <div><strong>Negara:</strong> <span id="previewNegara">-</span></div>
                        <div><strong>Distributor:</strong> <span id="previewDistributor">-</span></div>
                        <div><strong>Tanggal:</strong> <span id="previewTanggal">-</span></div>
                    </div>
                </div>
                <div id="previewPhotos" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;"></div>
            </div>
            <div style="padding: 20px; border-top: 1px solid #e0e0e0; display: flex; justify-content: flex-end; gap: 15px;">
                <button onclick="closePreview()" style="background: #95a5a6; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer;">Tutup</button>
                <button onclick="saveAll()" style="background: #27ae60; color: white; padding: 10px 25px; border: none; border-radius: 8px; cursor: pointer;">
                    <i class="fas fa-check-circle"></i> Simpan Semua
                </button>
            </div>
        </div>
    </div>
    <div id="loadingOverlay" class="loading-overlay"><div class="loading-spinner"><i class="fas fa-spinner"></i><p id="loadingText">Memuat...</p></div></div>
    <div id="toast-container"></div>
    <footer class="app-footer"><p><span>&copy; <span id="footerYear"></span></span><span class="footer-version">ver.2.1.0</span><span>by <span class="footer-brand">DuoBingo</span> for <span class="footer-company">Indofood</span></span></p></footer>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sheets-db.js"></script>
    <script src="js/create-display.js?v=2.11"></script>
    <script>
        document.getElementById('footerYear').textContent = new Date().getFullYear();
        document.getElementById('tanggal').valueAsDate = new Date();
        
        // Render info badges on load
        function renderInfoBadges() {
            const data = localStorage.getItem(CONFIG.STORAGE_KEYS.TEMP_DATA);
            if (data) {
                const tempData = JSON.parse(data);
                const badges = document.getElementById('infoBadges');
                
                badges.innerHTML = '';
                
                if (tempData.flavor) {
                    badges.innerHTML += `<span class="info-badge"><i class="fas fa-tag"></i> ${tempData.flavor}</span>`;
                }
                if (tempData.nomorMaterial) {
                    badges.innerHTML += `<span class="info-badge"><i class="fas fa-barcode"></i> ${tempData.nomorMaterial}</span>`;
                }
                if (tempData.negara) {
                    badges.innerHTML += `<span class="info-badge"><i class="fas fa-globe"></i> ${tempData.negara}</span>`;
                }
                if (tempData.distributor) {
                    badges.innerHTML += `<span class="info-badge"><i class="fas fa-truck"></i> ${tempData.distributor}</span>`;
                }
                if (tempData.tanggal) {
                    const date = new Date(tempData.tanggal);
                    const formatted = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                    badges.innerHTML += `<span class="info-badge"><i class="fas fa-calendar"></i> ${formatted}</span>`;
                }
                
                // Update page subtitle for edit mode
                if (tempData.isEdit) {
                    document.getElementById('pageSubtitle').textContent = 'Edit data display yang sudah ada';
                }
                
                document.getElementById('infoBadgesSection').style.display = 'block';
            } else {
                document.getElementById('infoBadgesSection').style.display = 'none';
            }
        }
        
        function toggleEditForm() {
            const container = document.getElementById('editFormContainer');
            container.classList.toggle('show');
        }
        
        function saveEditInfo() {
            // Update badges
            renderInfoBadges();
            // Close edit form
            document.getElementById('editFormContainer').classList.remove('show');
            showToast('Info display diperbarui', 'success');
        }
        
        // Render on load
        renderInfoBadges();
    </script>
</body>
</html>
